#6. Find top three tags where posts marked with those tags receive the largest number of votes. For each such tag, report the number of posts and the total number of votes on those posts. "the number of votes" for a tag refers to the total number of votes on all posts marked with that tag.

select votes.pid --post with max votes
from votes
where votes.vno = (select max(votes.vno) from votes);

p031
p032

select votes.pid, tags.tag, votes.vno -- tags associated with post having max votes
from votes, tags
where votes.vno = (select max(votes.vno) from votes)
and votes.pid = tags.pid;

p031|boring|24
p031|extra tag|24
p031|fun|24
p031|just here|24
p031|sleep|24
p032|fun|24
p032|sleep|24

select distinct tags.tag. -- top 3 tags from above
from votes, tags
where votes.vno = (select max(votes.vno) from votes)
and votes.pid = tags.pid
limit 3;

boring
extra tag
fun

select tags.tag, count(*) -- for every tag, number of posts associated with
from tags
group by tags.tag;

CMPUT291|1
Database|3
RELATIONAL|1
Sql language|1
access|1
boring|2
computing|1
data|1
database|4
extra tag|1
frequentTag1|2
frequentTag3|5
fun|3
just here|1
more tag|1
query|5
relational|7
sleep|3
sql|4
sql language|3
tag tag|1
tag test|1
test tag|1
tieTag1|2

select tags.tag, count(tags.pid) -- top 3 tags with total of post that top 3 tags refers
from tags
where tags.tag in (select distinct tags.tag
from votes, tags
where votes.vno = (select max(votes.vno) from votes)
and votes.pid = tags.pid
limit 3)
group by tags.tag;

boring|2
extra tag|1
fun|3

--- Try to find for each tag total number of votes on all posts that tags refer to 

select tags.tag, count(votes.vno)
from tags, votes
where tags.pid = votes.pid
group by tags.tag;

CMPUT291|1
Database|4
access|2
boring|46
data|1
database|5
extra tag|24
frequentTag1|6
frequentTag3|2
fun|70
just here|24
more tag|22
query|1
relational|8
sleep|70
sql|2
tag tag|22
tag test|22
test tag|22
tieTag1|1

select A.tag, acnt, bcnt
from (select tags.tag, count(tags.pid) as acnt -- top 3 tags with total of post that top 3 tags refers
from tags
where tags.tag in (select distinct tags.tag
from votes, tags
where votes.vno = (select max(votes.vno) from votes)
and votes.pid = tags.pid
limit 3)
group by tags.tag) A 
left join
(select tags.tag, count(votes.vno) as bcnt
from tags, votes
where tags.pid = votes.pid
group by tags.tag) B
on A.tag = B.tag;

boring|2|46
extra tag|1|24
fun|3|70

select A.tag, B.pcnt , A.cnt
from
(select tags.tag, count(votes.vno) as cnt
from votes, tags
where tags.pid = votes.pid
group by tags.tag
order by cnt desc
limit 3) A
left join
(select tags.tag, count(posts.pid) as pcnt
from tags, posts
where tags.pid = posts.pid
group by tags.tag) B
on A.tag = B.tag;

